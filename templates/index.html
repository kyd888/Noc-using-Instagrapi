<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="{{ url_for('static', filename='script.js') }}"></script>
</head>
<body>
    <div class="logo-container">
        <img src="{{ url_for('static', filename='logo.png') }}" alt="NOC Logo" class="logo">
    </div>
    <form id="login-form" method="POST">
        <fieldset class="no-border">
            <legend><h2>Login</h2></legend>
            <label for="insta_username">Instagram Username:</label><br>
            <input type="text" id="insta_username" name="insta_username" placeholder="Username"><br><br>
            <label for="insta_password">Instagram Password:</label><br>
            <input type="password" id="insta_password" name="insta_password" placeholder="Password"><br><br>
            <button type="submit"><span>â†’</span></button>
        </fieldset>
    </form>

    <div id="main-content" style="display:none;">
        <div id="left-panel">
            <form id="monitor-form">
                <label for="target_usernames">Target Usernames (comma-separated):</label><br>
                <input type="text" id="target_usernames" name="target_usernames" placeholder="Username1, Username2, ..."><br><br>
                <button type="submit" id="start-monitoring"><span>Start Monitoring</span></button>
                <button type="button" id="stop-monitoring" style="display:none;"><span>Stop Monitoring</span></button>
            </form>
            <div id="account-posts-list"></div>
        </div>
        <div id="right-panel">
            <h2>Comments</h2>
            <div id="scanned-comments">
                <div id="comment-text"></div>
                <div id="comment-counter"></div>
            </div>
            <div id="countdown">
                <h3>Next Monitoring Cycle:</h3>
                <div id="countdown-timer"></div>
            </div>
        </div>
    </div>

    <script>
        $(document).ready(function() {
            function fetchComments() {
                $.get('/get_comments', function(data) {
                    const commentsData = data.comments;
                    let commentText = '';
                    let commentCounter = 0;
                    for (const [username, comments] of Object.entries(commentsData)) {
                        commentCounter += comments.length;
                        for (const comment of comments) {
                            commentText += `<p><strong>${comment[0]}</strong>: ${comment[1]} <em>${comment[2]}</em></p>`;
                        }
                    }
                    $('#comment-text').html(commentText);
                    $('#comment-counter').text(`Total comments: ${commentCounter}`);
                });
            }

            function fetchCountdown() {
                $.get('/get_countdown', function(data) {
                    const countdownStatus = data.countdown_status;
                    if (countdownStatus) {
                        let countdownText = '';
                        for (const [user, time] of Object.entries(countdownStatus)) {
                            countdownText += `${user}: ${time}s<br>`;
                        }
                        $('#countdown-timer').html(countdownText);
                    } else {
                        $('#countdown-timer').html('No active countdowns.');
                    }
                });
            }

            setInterval(fetchComments, 5000); // Fetch comments every 5 seconds
            setInterval(fetchCountdown, 1000); // Fetch countdown status every second

            // Other JavaScript code for handling form submissions, etc.
        });
    </script>
</body>
</html>
